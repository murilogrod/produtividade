
Serviços SIMTR - Dossiê
-----------------------

Pendencias:
-----------
- Definição de classe documental para representação da pesquisa do SICPF
- Definição de classe documental para representação da pesquisa do SIPES
- Definição de classe documental para todos os possiveis documentos da CC junto ao SIECM com a definição dos atributos do documento
- Layout de comunição com solução de OCR (Depende da contratção, para a POC será Datacap Transacional)
	- O exemplo na chamada 3 esta voltado para CNH. Necessario definir os demais.
- Definir local de armazenamento do identificador da imagem quando submetido ao OCR (Sugestão: Criar atributo tb003.de_identificador_ocr, ou criar tabela de controle de documento em fase de extração)
- Definir regras de validação dos dados dos documentos com cruzamento em bases internas (Ex: Conferir se nome da pessoa confere com o nome localizado no SICPF baseado no CPF extraido do documento)
- Definir comportamento de acordo com o retorno do Antifraude
- Definição de classe documental para representação do Documento de Dados Declarados 
- Definir regra de guarda permanente dos documentos. 
	- Uma vez solicitada guarda seré removido atributo de temporalidade de todos os documentos do dia? 
	- O front-end deverá encaminhar o identificador de todos os documentos que terão a temporalidade removida?
- Definir formato, e regras de campos a serem alimentados junto so SICLI.



Chamada 1:
----------

+1) Sistema recebe solicitação de autorização para contratação de produto recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Produtos (Array com lista de produtos identificados por operação e modalidade)
+1.1) Realiza a validação do CPF/CNPJ indicado e caso não seja um valor valido deve ser definido para o objeto de retorno que não foi autorizado com a observção que o CPF/CNPJ é 
	 invalido e vai para o passo 9
+1.2) Identifica o registro do produto na base do SIMTR baseado no codigo de operação e modalidade indicados na solicitação que possua marcação positiva do dossiê digital, 
	 caso não seja localizado deve ser definido para o objeto de retorno que não foi autorizado e a indicação de que o produto solicitado não foi localizado e vai para o passo 9.
	
+2) O Sistema identifica se o valor indicado na requisição trata-se de um CPF ou CNPJ com o seguinte comportamento:
+2.1) O SIMTR verifica se o produto indicado permite contratação pelo tipo de pessoa (PF/PJ) indicado e caso não permita deve ser definido para o objeto de retorno que não foi 
	 autorizado e como observação, mensagem indicando o produto não permite contratação para o tipo de pessoa indicaso e vai para o passo 9
+2.2) Caso seja informado um CPF:
+2.2.1) Realiza a consulta do CPF junto ao SICPF
+2.2.2) Caso o resultado seja igual a 1,2,3,5,6,8 ou 9 define para o objeto de retorno que não foi autorizado e como observação, mensagem indicando a pendencia apontada pelo SICPF
+2.2.2.1) Cria o registro de autorização negada no sistema (tb102) com a indicação do motivo de pendencia junto ao CPF com mensagem indicando a pendencia apontada pelo SICPF (tb102.de_motivo) 
		 e vai para o paso 9
+2.2.4) Caso o resultado seja igual a 0 ou 4 verifica se já existe registro de vinculação do CPF e caso não haja, o sistema cria o registro relativo ao CPF
+2.2.5) Mantem o resultado devolvido pelo SICPF para geração de documento especifico que representará a pesquisa viculado ao dossiê do cliente.

-3) O sistema realiza a consulta do SIPES para o CPF/CNPJ indicado seguindo os seguintes passos
-3.2) Realiza a consulta do SIPES para os sistema parametrizados no registro do produto
-3.3) Para cada sistema retornado executa a seguinte rotina:
-3.3.1) Identifica proximo sistema no resultados das pesquisas do SIPES
-3.3.2) Verifica se existe algum comportamento de retorno para o produto desejado, com o sistema do SIPES em analise e com o(s) codigo(s) retornado(s). 
-3.3.3) Caso não seja localizado nenhum comportamento vai para o passo 3.3.4, caso seja localizado vai para o proximo passo;
-3.3.3.1) Acrescenta a orientação definida no registro (tb044.de_orientacao) junto ao retorno da solicitação de autorização
-3.3.3.2) Verifica se a autorização deve ser negada (tb044.ic_bloqueio) e em caso positivo, marca que a autorização deverá ser negada e acrescenta motivo apontado pelo SIPES concatena 
		 ao sistema analisado em mensagem para descrição de motivo da negativa
-3.3.4) Caso ainda existam mais sistemas a serem analisados retorna ao passo 3.3.1, caso contrário, vai para o passo 3.4
-3.4) Caso tenha ocorrido marcações de autorização negada, cria o registro de autorização negada no sistema (tb102) com a indicação do(s) motivo(s) de pendencia junto ao CPF com 
	 mensagem indicando a(s) pendência(s) apontada(s) pelo SIPES (tb102.de_motivo) e vai para o passo 9
-3.5) Inclui o resultado da pesquisa devolvida pelo SIPES no objeto de resposta da solicitação de autorização.
-3.6) Mantem o resultado devolvido pelo SIPES para geração de documento especifico que representará a pesquisa viculado ao dossiê do cliente.
	 
+4) Solicita ao SIECM coleção de documentos validos disponiveis para o CPF/CNPJ indicado.

+5) Baseado nos documentos localizados do CPF/CNPJ indicado atualiza os niveis documentais do mesmo.
+5.1) Captura todas as composições documentais cadastradas no sistema que estão validas (tb036.ts_revogacao is NULL)
+5.2) Para cada composição documental identificada, executa a seguinte rotina:
+5.2.1) Identifica a próxima composição documental
+5.2.2) Identifica todas as regras documentais vinculadas
+5.2.2.1) Identifica a proxima regra documental disponivel
+5.2.2.2) Caso a regra defina uma função documental a ser atendida, percorre todos os registros de documentos localizados junto ao SIECM, 
		 verifica se algum registro de documento oriundo do SIECM atende a algum dos tipos de documento associados a função junto ao SIMTR e,
		 caso positivo marca que o documento foi localizado para o atendimento a regra e vai para o passo 5.2.2.4
		 caso negativo marca a regra como não atendida e vai para o passo 5.2.3
+5.2.2.3) Caso a regra defina um tipo documental especifico a ser atendida, percorre todos os registros de documentos localizados junto ao SIECM, 
		 verifica se algum registro de documento oriundo do SIECM atende ao tipo de documento definido na regra junto ao SIMTR e,
		 caso positivo marca que o documento foi localizado para o atendimento a regra e vai para o passo 5.2.2.4
		 caso negativo marca a regra como não atendida e vai para o passo 5.2.3
+5.2.2.4) Caso existam regras ainda não testadas, vai para o passo 5.2.2.1, caso contrário, marca a Composição Documental como atendida vai para o passo 5.2.3
+5.2.3) Caso todas as regras tenham sido atendidas, marca a composição documental como atendida e vai para o passo 5.2.4, caso contrario apenas vai para o passo 5.2.4
+5.2.4) Caso ainda existam mais composições documentais não testadas retorna ao passo 5.2.1, caso contrário, vai para o passo 5.3
+5.3) Exclui todas as composições previamente existentes para o CPF/CNPJ indicado
+5.4) Inclui um registro do nivel documental (tb038) associando a composição documental ao dossiê do cliente com CPF/CNPJ indicado

+6)Percorre a lista de produtos solicitados na autorização 
+6.1) Identifica o proximo produto na solicitação e captura operação e modalidade informados
+6.2) Solicita autorização especifica para operação e modalidade indicado
+6.2) Captura as composições documentais associadas ao produto vinculado a operação e modalidade indicados
+6.3) Inicializa o objeto de retorno da operação com CPF/CNPJ, Tipo de Pessoa, Operação e Modalidade indicados na solicitação
+6.3) Caso não sejam localizadas composições documentais, define para o objeto de retorno que o produto não foi localizado e vai para o passo 9
+6.4) Caso sejam localizadas composições define para o objeto de retorno que o produto foi localizado e o seu nome cadastrado na base do SIMTR para a operação e modalidade indicados
+6.5) Para cada composição documental identificada, executa a seguinte rotina:
+6.5.1) Identifica a proxima composição documental
+6.5.2) Identifica todas as regras documentais vinculadas
+6.5.2.1) Identifica a proxima regra documental disponivel
+6.5.2.2) Caso a regra defina uma função documental a ser atendida, percorre todos os registros de documentos localizados junto ao SIECM, 
		 verifica se algum registro de documento oriundo do SIECM atende a algum dos tipos de documento associados a função junto ao SIMTR e,
		 caso positivo marca a regra atendida e o documento utilizado no atendimento a regra e vai para o passo 6.5.2.4
		 caso negativo marca a regra como não atendida e a função documental pendente vai para o passo 6.5.2.4
+6.5.2.3) Caso a regra defina um tipo documental especifico a ser atendida, percorre todos os registros de documentos localizados junto ao SIECM, 
		 verifica se algum registro de documento oriundo do SIECM atende ao tipo de documento definido na regra junto ao SIMTR e,
		 caso positivo marca o documento utilizado no atendimento a regra e vai para o passo 6.5.2.4
		 caso negativo marca a regra como não atendida e o tipo documental especifico pendente e vai para o passo 6.5.2.4
+6.5.2.4) Caso existam regras ainda não testadas, vai para o passo 6.5.2.1, caso contrário vai para o passo 6.5.3
+6.5.3) Caso todas as regras tenham sido atendidas, vai para o passo 6.7, caso contrario apenas vai para o passo 6.5.4
+6.5.4) Caso ainda existam mais composições documentais não testadas retorna ao passo 6.5.1, caso contrário, vai para o passo 6.6
+6.6) Define para o objeto de retorno que não foi autorizado e quais os tipos documentais / funções documentais pendentes para o autorização solicitada e vai para o passo 9
+6.7) Cria o registro de autorização no sistema (tb100) com a indicação os documentos utilizados no atendimento a composição (tb101)
+6.8) Define no objeto de retorno o NSU da autorização criada e a lista de documentos utilizados vai para o passo 7

+7) Cria a pasta de transação junto ao SIECM para vincular os documentos utilizados na operação
+7.1) Cria o registro da transação utilizando o padrão "<CPF/CNPJ>_<NSU-AUTORIZACAO>" e caso gere uma exceção vai para o passo 7.4
+7.2) Cria o vinculo dos documentos utilizados na autorização na pasta de transação criada no passo 7.1 e caso gere uma exceção vai para o passo 7.4
+7.3) Atualiza o retorno do registro da autorização no SIMTR com a data/hora e protocolo de informe ao SIECM (tb100.ts_informe_ecm = now() e tb100.co_protocolo_ecm = "<MENMSAGEM_RETORNO>")
	 e vai para o passo 8
+7.4) Em caso de exceção na comunicação com o SIECM, invalida o registro da autorização no SIMTR (tb100.ts_informe_ecm = now() e tb100.co_protocolo_ecm = "<MENSAGEM_SIECM>")
+7.4.1) Define para o objeto de retorno da autorização que não foi autorizado e como observação a mensagem "Falha de Comunicação com o sistema ECM"

8) Cria documentos das pesquisas realizadas junto so SICPF e SIPES (Passo 2 e 3)
+8.1) Cria um documento pra armazenar o resultado da pesquisa do SICPF (TIPOLOGIA A SER DEFINIDA) e salva o mesmo no dossiê do cliente junto ao SIECM
-8.2) Cria um documento pra armazenar o resultado da pesquisa do SIPES (TIPOLOGIA A SER DEFINIDA) e salva o mesmo no dossiê do cliente junto ao SIECM

+9) Retorna o objeto que representa a resposta do pedido de autorização


POST /simtr-api/rest/dossie-digital/v2/autorizacao

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"produtos" : [
		{
			"operacao" : 1,
			"modalidade" : 0
		},
		{
			"operacao" : 110,
			"modalidade" : 0
		}
	]
}

Resposta 200:

[
    {
        "autorizacao": 383554059308508,
        "autorizado": true,
        "produto_localizado": true,
        "data_hora": "2018-01-15 10:45:49.835",
        "cpf_cnpj": "11122233301",
        "tipo_pessoa": "F",
        "operacao": 1,
        "modalidade": 0,
        "produto": "CONTA_CORRENTE_PF",
        "documentos_utilizados": [
            {
				"tipo" : "CNH"
				"link" : "http://siecm.corp.caixa.gov.br/XXXXXXXXXXXXXXXXXXXXXX"
			},
			{
				"tipo" : "Conta de Luz"
				"link" : "http://siecm.corp.caixa.gov.br/XXXXXXXXXXXXXXXXXXXXXX"
			},
			{
				"tipo" : "Contracheque"
				"link" : "http://siecm.corp.caixa.gov.br/XXXXXXXXXXXXXXXXXXXXXX"
			}
        ],
		"observacao": null,
		"resultado_pesquisa" : { <OBJETO_RESULTADO> },
		"mensagens_orientacao" : [
			{
				"sistema" : "<NOME_SISTEMA> (SINAD/SICOW/etc)",
				"mensagem" : "XXXXXXXXXXXXXXXXXXXXXX"
			},
			{
				"sistema" : "<NOME_SISTEMA> (SINAD/SICOW/etc)",
				"mensagem" : "XXXXXXXXXXXXXXXXXXXXXX"
			},
		]
    },
    {
        "autorizado": false,
        "produto_localizado": true,
        "data_hora": "2018-01-15 10:45:50.343",
        "cpf_cnpj": "11122233301",
        "tipo_pessoa": "F",
        "operacao": 110,
        "modalidade": 0,
        "produto": "CONSIGNADO",
        "documentos_utilizados": [
            {
				"tipo" : "Conta de Luz"
				"link" : "http://siecm.corp.caixa.gov.br/XXXXXXXXXXXXXXXXXXXXXX"
			},
			{
				"tipo" : "Contracheque"
				"link" : "http://siecm.corp.caixa.gov.br/XXXXXXXXXXXXXXXXXXXXXX"
			}
        ],
		"documentos_pendentes": [
            "REGISTRO_CRM"
        ],
        "observacao": null,
		"resultado_pesquisa" : { <OBJETO_RESULTADO> }
		"mensagens_orientacao" : [
			{
				"sistema" : "<NOME_SISTEMA> (SINAD/SICOW/etc)",
				"mensagem" : "XXXXXXXXXXXXXXXXXXXXXX"
			},
			{
				"sistema" : "<NOME_SISTEMA> (SINAD/SICOW/etc)",
				"mensagem" : "XXXXXXXXXXXXXXXXXXXXXX"
			},
		]
    }
]


-------------------------------------------------------------------------------------------------------------

Chamada 3:
----------

+1) SIMTR recebe solicitação de extração de dados de imagem recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Formato da imagem
	- Tipo de Documento
	- Imagem em padrão base64

+2) SIMTR submete imagem para o servico de extração de dados (LAYOUT A DEFINIR)
+2.1) Para a POC será utilizado DataCap Transacional com os seguintes padrões:
	 - Endpoint: http://siecm.des.caixa/siecm-web/ECM/datacap/extraiDados
	 - Headers:
		+ Content-Type: application/xml
		+ Authorization: <TOKEN_SSO>
	 - Corpo da mensagem:
		<?xml version="1.0" encoding="UTF-8"?>
		<ExtrairDadosImagemDataCap>
			<dadosRequisicao>
				<tipoRequisicao>EXTRAIR_DADOS_IMAGEM_DATACAP</tipoRequisicao>
				<localArmazenamento>OS_CAIXA</localArmazenamento>
				<ipUsuarioFinal>10.198.168.10</ipUsuarioFinal>  
			</dadosRequisicao>
			<dataCapApp>CNH_Trans</dataCapApp>
			<informacoesImagem>
				<tipoDeDocumento>cnh</tipoDeDocumento>
				<nome>cnh.tif</nome>
				<formato>tif</formato>
				<binario>CONTEUDO_DA_IMAGEM_EM_PADRAO_BASE64</binario>
			</informacoesImagem>
		</ExtrairDadosImagemDataCap>

+2.2) Recebe dados da imagem em processo de extração.
		
+3) Cria registro de controle do documento (tb003) com tipo de documento definido com status temporario, cria o documento para ser submetido ao SIECM,
	encaminhando para guarda, cria o vinculo junto a tabela de conteudos do documento (tb008).

+4) Devolve objeto mapeado com os dados extraidos da imagem


POST /simtr-api/rest/dossie-digital/v1/documento/extracao-dados

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"formato" : "XXXX", (Ex: TIFF / PNG / etc)
	"classe" : "<IDENTIFICADOR_DA_CLASSE_DOCUMENTAL>" (Ex: CNH / RG / CONTA_LUZ / etc)    (Atributo Opcional - Se não estiver definido o serviço de OCR deverá classificar)
	"imagens" : [
			"<BINARIO_DA_IMAGEM_BASE_64>",
			"<BINARIO_DA_IMAGEM_BASE_64>",
			.....,
			"<BINARIO_DA_IMAGEM_BASE_64>"
	]
}

Resposta 200:
{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"formato" : "XXXX", (Ex: TIFF / PNG / etc)
	"tamanho" : 999999 (Tamanho em bytes)
	"identificador" : "<IDENTIFICADOR_UNICO_DA_IMAGEM_NO_SIMTR>"
	"link" : "<LINK_DA_IMAGEM_NO SIECM>"
	"dados" : [
		{
			"chave" : "NOME_DO_ATRIBUTO_EXTRAIDO",
			"valor" : "CONTEUDO_DO_ATRIBUTO_EXTRAIDO",
		},
		{
			"chave" : "NOME_DO_ATRIBUTO_EXTRAIDO",
			"valor" : "CONTEUDO_DO_ATRIBUTO_EXTRAIDO",
		}
	]
}

Resposta 503: Service Unavailable

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"codigo_retorno" : 99,
	"observacao": <DESCRICAO_DA_CAUSA_DA_FALHA_DE_COMUNICACAO> (Provavelmente falha de comunicação com o GED)	
}

-------------------------------------------------------------------------------------------------------------

Chamada 4:
----------

+1) SIMTR recebe solicitação de atualização dos dados da imagem extraidos dos documentos e validados pelo usuario do front-end recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Identificador do documento
	- Dados do documento

+2) SIMTR localiza o documento com base no identificador 
+2.1) SIMTR captura documento no SIECM
+2.2) Caso ocorra alguma exceção com a comunicação do SIECM vai para o passo 8
-3) SIMTR realiza validações automazadas conforme o tipo de documento efetuando cruzamento dos dados com as bases locais (DEFINIR REGRAS DE VALIDAÇÃO)
+4) SIMTR atualiza atributos do documento junto ao SIECM
+4.1) Caso ocorra alguma exceção com a comunicação do SIECM vai para o passo 8
-5) SIMTR submete documento (Imagem do SIECM e dados atualizados recebidos na requisição) para o sistema Antifraude
-5.1) Caso ocorra alguma exceção com a comunicação do Antifraude vai para o passo 8, senão vai para o passo 5.2
-5.2) Caso o sistema retorne negativa de fraude para o documento vai para o passo 6, caso contrario vai para o passo 7
+6) Retorna resposta com codigo 204 e finaliza o processo.
-7) A DEFINIR COMPORTAMENTO DE RETORNO POSITIVO PARA SOLUÇÂO Antifraude
+8) Retorna resposta de falha com codigo de retorno 503, atributo de codigo_retorno com codigo de falha apontado pela solução SIECM ou Antifraude e finaliza o processo.

POST /simtr-api/rest/dossie-digital/v1/documento/atualizacao-dados

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"identificador" : "<IDENTIFICADOR_UNICO_DA_IMAGEM_SIMTR>"
	"dados" : [
		{
			"chave" : "NOME_DO_ATRIBUTO",
			"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
		},
		{
			"chave" : "NOME_DO_ATRIBUTO",
			"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
		}
	]
}


Resposta 204: Success - No Content

Os dados foram atualizados com sucesso e não é necessario nenhuma resposta.

Resposta 503: Service Unavailable

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"identificador" : "<IDENTIFICADOR_UNICO_DA_IMAGEM_SIMTR>"
	"codigo_retorno" : 99,
	"observacao": <DESCRICAO_DA_CAUSA_DA_FALHA_DE_COMUNICACAO> (Provavelmente falha de comunicação com o GED / Antifraude)	
}


-------------------------------------------------------------------------------------------------------------

Chamada 7:
----------

+1) SIMTR recebe solicitação de criação/atualização dos dados declarados do cliente pelo front-end recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Dados do documento

+2) SIMTR verifica junto ao SIECM se já existe documento de dados declarados junto ao dossiê do cliente	
+2.1) Caso ocorra alguma exceção vai para o passo 6
+3) SIMTR cria ou atualiza o documento de dados declarados com base nas informações encaminhadas
+4) SIMTR encaminha o documento de dados declarados para guarda junto ao dossiê do cliente.
+4.1) Caso ocorra alguma exceção vai para o passo 6
+5) Retorna resposta com codigo 204 e finaliza o processo.
+6) Retorna resposta de falha com codigo de retorno 503, atributo de codigo_retorno com codigo de falha apontado pela solução SIECM ou Antifraude e finaliza o processo.


POST /simtr-api/rest/dossie-digital/v1/documento/dados-declarados

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"dados" : [
		{
			"chave" : "NOME_DO_ATRIBUTO",
			"valor" : "CONTEUDO_DO_ATRIBUTO",
		},
		{
			"chave" : "NOME_DO_ATRIBUTO",
			"valor" : "CONTEUDO_DO_ATRIBUTO",
		}
	]
}
	
Resposta 204: Success - No Content

Os dados foram atualizados com sucesso e não é necessario nenhuma resposta.

Resposta 503: Service Unavailable

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"codigo_retorno" : 99,
	"observacao": <DESCRICAO_DA_CAUSA_DA_FALHA_DE_COMUNICACAO> (Provavelmente falha de comunicação com o GED)
}



-------------------------------------------------------------------------------------------------------------

Chamada 8:
----------

+1) SIMTR recebe solicitação de guarda permanente dos documentos incluidos no dossiê do cliente que estão com status de temporario pelo front-end recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Lista de documentos (A DEFINIR)

+2) SIMTR captura documentos relacionados ao dossiê do cliente que foram atualizados e que estão com status de temporario
+2.1) SIMTR atualiza status de temporario para a condição de arquivo definitivo, e atualiza as informações do documento (tb003) e junto SIECM.
+2.2) Caso ocorra alguma exceção vai para o passo 5

-3) Realiza atualização cadastral junto ao SICLI com base nas informações dos documentos utilizados na alimentação do dossiê do cliente (DEFINIR REGRAS)
-3.1) Caso ocorra alguma exceção vai para o passo 5

+4) Retorna resposta com codigo 204 e finaliza o processo.

+5) Retorna resposta de falha com codigo de retorno 503, atributo de codigo_retorno com codigo de falha apontado pela solução SIECM ou Antifraude e finaliza o processo.

POST /simtr-api/rest/dossie-digital/v1/cadastro/atualizacao

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"documentos" : [
		"<IDENTIFICADOR_UNICO_DA_IMAGEM_SIMTR>",
		"<IDENTIFICADOR_UNICO_DA_IMAGEM_SIMTR>",
		....
		"<IDENTIFICADOR_UNICO_DA_IMAGEM_SIMTR>"
	]
}
	
Resposta 204: Success - No Content

Os dados foram atualizados com sucesso e não é necessario nenhuma resposta.

Resposta 503: Service Unavailable

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"codigo_retorno" : 99,
	"observacao": <DESCRICAO_DA_CAUSA_DA_FALHA_DE_COMUNICACAO> (Provavelmente falha de comunicação com o GED ou SICLI)
}

-------------------------------------------------------------------------------------------------------------

Chamada 9:
----------

+1) SIMTR recebe solicitação de guarda dos documentos da operação pelo front-end recebendo os parametros:
	- CPF / CNPJ (Caso altere para receber String com 11/14 digitos torna o parametro "tipo pessoa" desnecessario)
	- Tipo Pessoa (F/J)
	- Dados dos documentos

+2) Identifica o registro do produto e os documentos vinculados com a autorização encaminhada	
+2.1) SIMTR identifica o registro da autorização (tb100) com base no codigo de autorização informado e caso não localize monta retorno com status 400 e vai para o passo 5
+2.1) Com o registro de autorização identifica os documentos utilizados na emissão da autorização e o produto baseado na operação e modalidade vinculados com a autorização.
+2.2) Captura os objetos de documentos utilizados (tb003) e o produto vinculado (tb022)

+3) Vincula os registros do produto e dos documentos utilizados junto ao dossiê de produto
+3.1) Cria o registro de dossiê de produto (tb002) com definição do processo do Dossiê Digital (FK para tb020)
+3.2) Vincula o dossiê de produto criado com o produto localizado no passo 2 (tb024)
+3.3) Vincula o dossiê de produto criado com os documentos utilizados na autorização através da criação de instâncias (tb014) com situação de documento avaliado pelo fluxo do dossiê (tb017)

+4) Cria o registro dos documentos encaminhados na solicitação
+4.1) Captura todas os documentos encaminhados na solicitação
+4.2) Para cada documento identificada, executa a seguinte rotina:
+4.2.1) Captura o elemento que representa o proximo documento
+4.2.2) Cria o documento a ser submetido ao SIECM conforme classe documental indicada
+4.2.3) Submete documento ao SIECM vinculando a pasta de transação relacionada ao codigo da autorização encaminhada.
+4.2.4) Cria o registro do documento (tb003)
+4.2.5) Cria o registro dos conteudos do documento (tb008) vinculados ao registro do documento
+4.2.6) Define para o objeto de retorno o link de visualização do documento junto ao SIECM com a identificação da classe documental  vinculada
+4.2.7) Caso existam regras ainda não testadas, vai para o passo 4.2.1, caso contrário, marca a Composição Documental como atendida vai para o passo 4.3

+5) Retorna o objeto que representa a resposta do pedido de guarda dos documentos


POST /simtr-api/rest/dossie-digital/v1/operacao/documentos-guarda

Exemplo Corpo:

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"autorizacao": 383554059308508,
	"documentos" : [
		{
			"classe_documental" : "XXXX",
			"atributos" : [
				{
					"chave" : "NOME_DO_ATRIBUTO",
					"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
				},
				{
					"chave" : "NOME_DO_ATRIBUTO",
					"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
				}
			],
			"conteudo" : [
				"<BINARIO_BASE_64>",
				"<BINARIO_BASE_64>",
				.....,
				"<BINARIO_BASE_64>"
			]
		},
		{
			"classe_documental" : "XXXX",
			"atributos" : [
				{
					"chave" : "NOME_DO_ATRIBUTO",
					"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
				},
				{
					"chave" : "NOME_DO_ATRIBUTO",
					"valor" : "CONTEUDO_DO_ATRIBUTO_PARA_ATUALIZAR",
				}
			],
			"conteudo" : [
				"<BINARIO_BASE_64>",
				"<BINARIO_BASE_64>",
				.....,
				"<BINARIO_BASE_64>"
			]
		}
	]
}
	
Resposta 201: Success - Created
{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"autorizacao": 383554059308508,
	"documentos" : [
		{
			"classe_documental" : "XXXX",
			"link" : "<LINK_DA_IMAGEM_NO SIECM>"
		}
	]
}

Resposta 400: Bad Request
{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"autorizacao": 383554059308508,
	"observacao" : "XXXXXXXXXXXXXXXXXXXXXX"
}

Resposta 503: Service Unavailable

{
	"cpf_cnpj" : 11122233301,
	"tipo_pessoa" : "F",
	"codigo_retorno" : 99,
	"observacao": <DESCRICAO_DA_CAUSA_DA_FALHA_DE_COMUNICACAO> (Provavelmente falha de comunicação com o GED)
}
