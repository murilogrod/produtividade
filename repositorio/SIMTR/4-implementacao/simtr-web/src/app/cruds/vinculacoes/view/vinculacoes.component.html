<div class="panel panel-default crud-align margem">
  <div class="panel-heading crud-style">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="input-group pull-left" style="width: 30%">
            <input pInputText type="text" class="form-control" #globalFilter 
              (input)="dataVinculacoes.filterGlobal($event.target.value, 'contains')" placeholder="Filtro Global">
            <span class="input-group-addon">
                <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </span>
        </div> 
        <div class="pull-right">
          <button type="button" class="btn btn-primary"
            (click)="abrirModalVinculacao();">Nova Vinculação
              <span class="fa fa-plus"></span>
          </button>
        </div>
    </nav> 
  </div>
</div> 
<div class="row">
    <div class="col-md-12">
        <p-table #dataVinculacoes [columns]="vinculacoesPresenter.vinculacoes.configTableColsVinculacoes" class="crud-table" (onFilter)="onFilter($event, globalFilter)"
        [paginator]="true" [rows]="15" [responsive]="true" (sortFunction)="realizarOrdenacao($event)" 
          [rowsPerPageOptions]="vinculacoesPresenter.vinculacoes.rowsPerPageOptions" [responsive]="true" scrollable="true" scrollHeight="500px"
            [customSort]="true" [value]="vinculacoesPresenter.vinculacoes.vinculacoesGrid">
          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
                <td [attr.colspan]="columns.length">
                    Nenhuma vinculação encontrada
                </td>
            </tr>
          </ng-template>   
          <ng-template pTemplate="header" let-columns>
            <tr>
              <ng-template ngFor let-col [ngForOf]="columns">
                  <ng-container [ngSwitch]="col.field">                      
                    <ng-container *ngSwitchCase="'acoes'">
                        <th class="{{col.class}}">
                            {{col.header}}
                        </th>                       
                    </ng-container>                                         
                    <ng-container *ngSwitchDefault>
                        <th *ngIf="col.tooltip" tooltipPosition="top" pTooltip="{{col.msg}}" class="{{col.class}}" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th> 
                        <th *ngIf="!col.tooltip" class="{{col.class}}" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>                                               
                    </ng-container>
                  </ng-container>
              </ng-template> 
            </tr>
          </ng-template>
          <ng-template #referenceOverlayPanel pTemplate="body" let-vinculacao let-columns="columns" let-index="rowIndex">
              <tr>
                  <td style="width: 0px;">
                      <p-overlayPanel 
                        #erroVinculacaoConflitante 
                        [dismissable]="true" 
                        class="panel-error-conflito" 
                        [appendTo]="'referenceOverlayPanel'">
                        <label>
                          {{vinculacao.msgVinculacaoConflitante}}
                        </label>
                      </p-overlayPanel> 
                  </td>                 
                  <td *ngFor="let col of columns" [ngSwitch]="col.field" class="{{col.class}}">
                      <ng-container *ngSwitchCase="'acoes'">
                          <span 
                              class="fa fa-fw fa-trash" 
                              tooltipPosition="top" 
                              (click)="removerVinculacao(index, vinculacao);"
                              pTooltip="Remover Vinculação"
                              style="cursor: pointer">
                          </span>                                                     
                          <i id="vinculacao-conflitante" 
                            class="fa fa-exclamation-circle" 
                            *ngIf="vinculacao.conflitoVinculacao"
                            (mouseenter)="erroVinculacaoConflitante.show($event);"
                            (mouseleave)="erroVinculacaoConflitante.hide();"
                            style="color:#f39c12; cursor: pointer;">
                          </i> 
                          <span 
                            class="fa fa-fw fa-edit" 
                            *ngIf="vinculacao.conflitoVinculacao"
                            tooltipPosition="top" 
                            pTooltip="Editar Vinculação Conflitante"
                            (click)="abrirModalVinculacaoConflitante(index, vinculacao);"
                            style="cursor: pointer; margin: 1px;">
                          </span>                                                                                                  
                      </ng-container> 
                      <ng-container *ngSwitchCase="'id'">
                          {{vinculacao[col.field] != undefined ? vinculacao[col.field] : '-'}}
                      </ng-container>                                                  
                      <ng-container *ngSwitchDefault>
                        <div class="vinculacao capitalize" tooltipPosition="top" pTooltip="{{vinculacao[col.field]}}">
                          {{vinculacao[col.field] != undefined ? vinculacao[col.field] : '-'}}
                        </div>
                      </ng-container>                          
                  </td>
              </tr>
          </ng-template>
          <ng-template pTemplate="summary">
              <ng-container *ngIf="vinculacoesPresenter.vinculacoes.filteredRecords == 0">
                Total: {{vinculacoesPresenter.vinculacoes.vinculacoesGrid.length}} vinculação(ões).
              </ng-container>
              <ng-container *ngIf="vinculacoesPresenter.vinculacoes.filteredRecords > 0">
                Total: {{vinculacoesPresenter.vinculacoes.filteredRecords}} de {{vinculacoesPresenter.vinculacoes.vinculacoesGrid.length}}.
            </ng-container>            
          </ng-template>
        </p-table>
    </div>
</div>